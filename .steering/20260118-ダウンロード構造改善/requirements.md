# 要件定義: ダウンロード構造改善

## 背景

現在、有価証券報告書等は `downloads/pdfs/{doc_id}.pdf` のフラットな構造で保存されている。
これでは企業別・書類種別での整理が困難であり、ローカルキャッシュの活用も難しい。

## 要件

### 1. ダウンロードフォルダ構造の変更

**現状:**
```
downloads/pdfs/S100ABCD.pdf
```

**変更後:**
```
downloads/{sec_code}_{company_name}/{doc_type_code}_{doc_type_name}/{YYYYMM}/{doc_id}.pdf
```

**例:**
```
downloads/72030_トヨタ自動車/120_有価証券報告書/202512/S100ABCD.pdf
```

### 2. ローカルキャッシュ優先検索

- ユーザーから指示が入力された際、まず `downloads/` フォルダでファイルを検索
- ファイルがない場合のみEDINET APIに検索に行く
- API呼び出しを削減し、レスポンス速度を向上

### 3. ログ出力の改善

- 現在、ユーザーからの入力後にログが出力されていない
- 何が進行しているかをユーザーに表示してストレスを軽減
- richライブラリを使用したリッチな進捗表示

## 確定事項

| 項目 | 決定 |
|------|------|
| メタデータ取得方法 | 呼び出し元（search_documents）からDocumentMetadataを渡す |
| 進捗表示 | richライブラリ使用（色付き・アイコン付き） |
| 既存ファイル | 手動移行（そのまま残す） |

## 非機能要件

- 既存のダウンロード済みファイルは新構造では検出されない（手動移行が必要）
- フォルダ名に使用できない文字（`/`, `\`, `:` 等）はアンダースコアに置換
