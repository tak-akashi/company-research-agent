# 要求内容

## 概要

EDINET API連携における検索・フィルタリング機能を実装し、PRDの受入条件1-4を満たすサービスレイヤーを構築する。

## 背景

現在のEDINETClientは日付単位でのAPI呼び出しのみをサポートしており、企業コード検索、企業名検索、期間指定検索、書類種別フィルタリングといったビジネスロジックが実装されていない。PRDの受入条件6項目中、4項目（受入条件1-4）が未実装である。

EDINET APIの仕様制約:
- APIは日付単位でのみデータを返す（期間指定検索は複数日付のループ処理が必要）
- フィルタリングはクライアント側で実行する必要がある

## 実装対象の機能

### 1. 企業コード検索（受入条件1）
- 証券コード（5桁、例: 7203）で書類を検索
- EDINETコード（6桁、例: E00001）で書類を検索
- `sec_code` / `edinet_code` フィールドでフィルタリング

### 2. 企業名検索（受入条件2）
- 企業名の部分一致検索
- `filer_name` フィールドで部分一致フィルタリング
- 「トヨタ」で「トヨタ自動車」「トヨタ紡織」等が複数ヒット

### 3. 期間指定検索（受入条件3）
- start_date〜end_dateの範囲で検索
- 内部で日付ループ処理を行い、結果を集約
- 営業日のみを対象（EDINET APIが返すデータのみ）

### 4. 書類種別フィルタリング（受入条件4）
- doc_type_codeによるフィルタリング
  - 120: 有価証券報告書
  - 140: 四半期報告書
  - 180: 臨時報告書
- 複数種別の同時指定に対応

## 受け入れ条件

### 企業コード検索
- [ ] 証券コード（7203）でトヨタの書類が検索できる
- [ ] EDINETコードで書類が検索できる
- [ ] 存在しないコードで空リストが返る

### 企業名検索
- [ ] 「トヨタ」で部分一致検索ができる
- [ ] 複数企業がヒットする場合、全てが返る
- [ ] 検索結果がない場合、空リストが返る

### 期間指定検索
- [ ] start_date〜end_dateの範囲で検索できる
- [ ] 指定期間外の書類が含まれない
- [ ] 期間が長い場合も正しく処理される

### 書類種別フィルタリング
- [ ] doc_type_code=120で有価証券報告書のみ取得できる
- [ ] 複数のdoc_type_codeを指定できる
- [ ] フィルタ指定なしで全種別が返る

## 成功指標

- PRDの受入条件1-4が全てクリアされる
- ユニットテストカバレッジ80%以上
- 既存のEDINETClientとの統合が円滑

## スコープ外

以下はこのフェーズでは実装しません:

- REST APIエンドポイント（api/層）の追加
- 統合テスト・E2Eテスト（ユニットテストのみ）
- データベース連携
- キャッシュ機構

## 参照ドキュメント

- `docs/product-requirements.md` - プロダクト要求定義書（受入条件の原文）
- `docs/functional-design.md` - 機能設計書（DocumentFilter, EDINETClientProtocolの設計）
- `docs/architecture.md` - アーキテクチャ設計書（レイヤー構造）
- `docs/development-guidelines.md` - 開発ガイドライン
- `.steering/20260116-EDINET-API連携/acceptance-check.md` - 受入条件チェック結果
