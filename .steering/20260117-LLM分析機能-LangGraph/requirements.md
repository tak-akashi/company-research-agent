# 要求内容

## 概要

PDF解析・マークダウン化機能の後に、LLM分析機能を早期価値提供のために先行実装する。各機能をLangGraphのノードとして構造化し、並列実行と個別出力・統合レポートの両方に対応する。

## 背景

- 有価証券報告書（有報）のPDFがマークダウン形式で取得可能になった
- 投資家として、有報の内容を効率的に分析し、投資判断に必要な情報を抽出したい
- 各分析機能（事業要約、リスク抽出、財務分析、前期比較）は独立して試行錯誤が必要
- LangGraphを活用することで、各機能をノードとして構造化し、並列実行・個別テストを可能にする

## 実装対象の機能

### 1. 事業状況・経営分析の要約（BusinessSummaryNode）

- 有報の「事業の状況」「経営者による分析」セクションを要約
- 主要事業・戦略の抽出
- 重要ポイントの箇条書き

### 2. リスク要因の抽出・整理（RiskExtractionNode）

- 「事業等のリスク」セクションからリスク要因を抽出
- カテゴリ別分類（市場リスク、事業リスク、財務リスク、規制リスク等）
- リスクの重要度・影響度の評価

### 3. 財務データの特徴・変化点抽出（FinancialAnalysisNode）

- 財務ハイライトの抽出
- 前期比の変化点検出
- 財務上の強み・懸念事項の分析

### 4. 前期比較・変化点自動検出（PeriodComparisonNode）

- 2期分の有報を比較
- 重要な変化点の検出
- 改善領域・懸念領域の特定

### 5. LangGraphワークフロー基盤

- AnalysisState（状態管理）の実装
- 並列実行対応のグラフ構築
- 個別ノード実行と全体実行の両方に対応

## 受け入れ条件

### 基盤整備
- [ ] `workflows/state.py`にAnalysisStateが定義されている
- [ ] `schemas/llm_analysis.py`に分析結果スキーマが定義されている
- [ ] `workflows/nodes/base.py`にノード基底クラスが定義されている

### 事業要約機能
- [ ] 有報から「事業の状況」「経営者による分析」を適切に要約できる
- [ ] 重要ポイントが3-5件抽出される
- [ ] BusinessSummaryスキーマに準拠した出力が得られる

### リスク抽出機能
- [ ] リスク項目が5件以上抽出される
- [ ] 各リスクがカテゴリ別に分類される
- [ ] RiskAnalysisスキーマに準拠した出力が得られる

### 財務分析機能
- [ ] 主要財務指標（売上高、営業利益等）の変化が検出される
- [ ] 財務上の強み・懸念事項が抽出される
- [ ] FinancialAnalysisスキーマに準拠した出力が得られる

### 前期比較機能
- [ ] 2期分の有報を比較し、変化点が3件以上検出される
- [ ] 改善領域・懸念領域が特定される
- [ ] PeriodComparisonスキーマに準拠した出力が得られる

### ワークフロー統合
- [ ] 個別ノードを単独で実行できる（run_single_node）
- [ ] 全ワークフローを実行できる（run_full_analysis）
- [ ] 3つの分析ノード（事業、リスク、財務）が並列実行される

### テスト
- [ ] 各ノードのユニットテストが通る
- [ ] E2Eテストで10社×2期（計20書類）の分析が完了する
- [ ] 型チェック（mypy）がエラーなく通る
- [ ] リント（ruff）がエラーなく通る

## 成功指標

- 10社の有報で事業要約・リスク抽出・財務分析が正常動作する
- 5社×2期の前期比較が正常動作する
- 並列実行により、逐次実行より処理時間が短縮される
- 各ノードが独立して開発・テスト可能である

## スコープ外

以下はこのフェーズでは実装しません:

- ベクトル検索機能（将来フェーズ）
- 企業Webページからの情報取得（将来フェーズ）
- データベースへの分析結果保存
- APIエンドポイントの追加
- Human-in-the-loop機能

## 参照ドキュメント

- `docs/product-requirements.md` - プロダクト要求定義書
- `docs/functional-design.md` - 機能設計書
- `docs/architecture.md` - アーキテクチャ設計書
- `src/company_research_agent/clients/gemini_client.py` - Gemini APIクライアント
- `src/company_research_agent/parsers/pdf_parser.py` - PDFパーサー
