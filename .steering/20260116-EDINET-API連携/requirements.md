# 要求内容

## 概要

EDINET API（金融庁が提供する開示書類電子開示システムのAPI）との連携機能を実装し、企業の開示書類（有価証券報告書、四半期報告書等）のメタデータ取得およびファイルダウンロードを可能にする。

## 背景

- 個人投資家は企業の財務データを分析するために、EDINETから有価証券報告書等を手動で取得している
- 複数企業の書類を一括で取得・解析するには自動化が必要
- EDINET APIを活用することで、プログラムから効率的に開示書類を取得できる
- これはMVPのP0（必須）機能として定義されている

## 実装対象の機能

### 1. 書類一覧API連携
- 指定日付の書類一覧をEDINET APIから取得
- メタデータのみの取得（件数確認用）
- 提出書類一覧とメタデータの取得（詳細情報）

### 2. 書類ダウンロード機能
- 書類管理番号（doc_id）を指定して書類をダウンロード
- XBRLファイル（ZIP形式）のダウンロード
- PDFファイルのダウンロード
- CSVファイル（ZIP形式）のダウンロード

### 3. エラーハンドリングとリトライ
- APIエラー（401, 404, 500等）の適切な処理
- レート制限対応のためのリトライ機構（指数バックオフ）
- ネットワークエラー時のリトライ

### 4. 設定管理
- APIキーの環境変数管理
- ベースURL、タイムアウト等の設定

## 受け入れ条件

### 書類一覧API連携
- [ ] 日付を指定して書類一覧を取得できる
- [ ] メタデータのみ（type=1）と詳細情報（type=2）を切り替えられる
- [ ] レスポンスのmetadataとresultsを適切にパースできる
- [ ] EDINET APIのステータスコードを正しく処理できる

### 書類ダウンロード機能
- [ ] XBRL（type=1）をダウンロードしてZIPファイルとして保存できる
- [ ] PDF（type=2）をダウンロードして保存できる
- [ ] CSV（type=5）をダウンロードしてZIPファイルとして保存できる
- [ ] ダウンロード先ディレクトリを指定できる

### エラーハンドリングとリトライ
- [ ] 401エラー（認証エラー）を適切に処理できる
- [ ] 404エラー（書類が見つからない）を適切に処理できる
- [ ] 500エラー時に指数バックオフでリトライできる
- [ ] 最大3回のリトライ後に失敗を報告できる

### 設定管理
- [ ] EDINET_API_KEY環境変数からAPIキーを取得できる
- [ ] 設定をcoreモジュールで一元管理できる

## 成功指標

- テスト企業3社（トヨタ、ソフトバンクG、ソニー）で書類一覧を取得できる
- 有価証券報告書のPDF/XBRLをダウンロードできる
- ユニットテストカバレッジ80%以上

## スコープ外

以下はこのフェーズでは実装しません:

- 書類検索機能（複数日付を横断した検索）
- XBRL解析（別フェーズ）
- PDF解析（別フェーズ）
- データベース保存（別フェーズ）
- 日次バッチ処理（別フェーズ）
- REST APIエンドポイント（別フェーズ）

## 参照ドキュメント

- `docs/product-requirements.md` - プロダクト要求定義書
- `docs/functional-design.md` - 機能設計書
- `docs/architecture.md` - アーキテクチャ設計書
- `docs/research/edinet-api-specification.md` - EDINET API調査レポート
