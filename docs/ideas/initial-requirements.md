# COMPANY-DATASEARCH-ASSISTNT - アイデアメモ

## このドキュメントの位置づけ

このドキュメントは壁打ち・ブレストの成果物で、正式な仕様書ではありません。

## プロダクトビジョン

日本の上場企業が開示書類を掲載するサイトが金融庁の所管するEDINET(https://disclosure2.edinet-fsa.go.jp/WEEK0010.aspx)と東京証券取引所が所管するTDnet(https://www.release.tdnet.info/inbs/I_main_00.html)などに分かれており、投資家は有価証券報告書や決算短信・その他適時開示書類をそれぞれのサイトで横断的に検索し、PDF書類を取得しなければならない。さらに、それらの書類を分析してまとめるにはPDF資料を読み込み、分析が必要であり、なかなか個人投資家にとってはハードルが高い。

本プロダクトでは、これらの課題を解決し（個人）投資家が調査したい特定の企業名（あるいはコード）と期間を入力すると、当該企業が当該期間に開示した書類を検索・取得し、その内容を分析して結果を返却するAI Agentを構築したい。

まずは、無料で対応可能なEDINET APIとTDnet Web検索（API利用は有料でかなり高いため将来の課題）で行う。また、出来れば、当該企業のホームページを巡回し必要な情報を取得する。

**一言で言うと**: 企業情報検索・分析アシスタント

---

## 解決したい課題

### 今困っていること

1. **Edinet/TDnet/企業サイトを横断して情報を取得するのが手間**
   - EDINET(https://disclosure2.edinet-fsa.go.jp/WEEK0010.aspx)とDnet(https://www.release.tdnet.info/inbs/I_main_00.html)や企業サイトを横断的に検索して、ドキュメントを取得するのが手間

2. **開示書類のフォーマットが異なっており、データ取得が難しい**
  

3. **XBRL形式のデータもあるが仕様が複雑で利用しにくい**
　　- 決算の時系列分析や競合比較のデータを自動的に取得するのが難しい


---

## ターゲットユーザー

### ペルソナ: 個人投資家

- **年齢**: 25-35歳
- **職業**: 個人投資家
- **経験**: 投資歴歴5年以上、株式投資を数千万円実施している
- **今困ってること**:
  - 企業分析に手間がかかっており、四季報など一般的な情報や企業サイトを見て分析を行なっている
  - 独自な分析を行うべく、企業開示書類を見ているが時間と手間がかかっていてなんとかしたい
  - 機関投資家が使っているBloomberg等の専門ソースは高くて手がでない


## 主要機能の候補

### P0 (MVPで絶対必要)

#### 1. EDINET API連携
- 企業コード（証券コード/EDINETコード）または企業名で書類検索
- 期間指定での絞り込み
- PDF/XBRLファイルのダウンロード
- 対象書類: 有価証券報告書（年次）、四半期報告書、臨時報告書

#### 2. PDF解析・マークダウン化
- PDFからテキスト抽出
- 表のマークダウン化
- YOMITOKU + Gemini 2.5 Flash活用

#### 3. XBRL解析・財務データ抽出
- 財務諸表データの抽出（BS/PL/CF）
- 自前実装（既存ライブラリが不十分なため）

#### 4. 財務指標の計算
- 収益性: ROE, ROA, 営業利益率, 経常利益率
- 安全性: 自己資本比率, 流動比率, 固定比率
- 効率性: 総資産回転率, 棚卸資産回転率
- ※株価関連指標（PER, PBR等）は除外（別プロジェクトで対応）

#### 5. データベース化
- PostgreSQL + pgvector（将来のLLM分析・ベクトル検索対応）
- 書類メタデータ管理
- 財務データの永続化


### P1 (重要だけど後回しでもいい)

#### 6. 企業Webページからの情報取得
- 決算短信・決算説明会資料（PDF）
- 中期経営計画
- IRニュース


### P2 (あったら嬉しい)

#### 7. TDnet連携
- 有料APIのため優先度低
- 将来の課題として記録

---

## 差別化ポイント

### 既存ツールとの比較


### このツールの強み



---

## 技術的な検討事項

### アーキテクチャ
- **開発順序**: バックエンド（Pythonパッケージ）→ Streamlit簡易UI → 本格Web UI
- **利用形態**:
  - Pythonパッケージとして Jupyter Notebook から直接利用
  - REST API で Streamlit/Web UI から利用

### 技術スタック

| 項目 | 技術 | 選定理由 |
|------|------|----------|
| 言語 | Python | データ分析エコシステム |
| Webフレームワーク | FastAPI | 高速、型安全、OpenAPI自動生成 |
| PDF解析 | YOMITOKU + Gemini 2.5 Flash | 日本語表認識に強い |
| XBRL解析 | 自前実装 | EDINET独自仕様への対応 |
| データベース | PostgreSQL + pgvector | ベクトル検索対応（将来のLLM分析用） |
| 簡易UI | Streamlit | 高速プロトタイピング |

### データの保存方法
- PostgreSQL（pgvector拡張）
- 書類メタデータ、財務データ、将来的にベクトル埋め込みを格納

---

## 非機能要件（とりあえず）

### 前提条件
- 対象企業数: 数百社程度（特定セクターや指数構成銘柄）
- 更新頻度: 日次バッチ（1日1回自動取得）

### パフォーマンス
- 書類一覧の検索: 数秒以内（EDINET API依存）
- PDF解析: 1書類あたり数分以内（Gemini API依存）
- XBRL解析: 1書類あたり数秒以内
- 日次バッチ: 数百社の新規開示を数時間以内に処理

### 使いやすさ
- Jupyter Notebookから直感的に利用できるPython API
- 明確なエラーメッセージと例外処理
- 処理状況のログ出力
- サンプルノートブックの提供

### 信頼性
- API呼び出しのリトライ機構（レート制限対応）
- 処理失敗時の再実行可能性（冪等性）
- データ整合性チェック（重複排除）
- バッチ処理の中断・再開対応

### 拡張性
- 新しいデータソースの追加が容易な設計
- 新しい財務指標の追加が容易
- LLM分析機能の後付けが可能

---

## 成功指標（とりあえず）

### ユーザー視点
- 企業分析にかかる時間の大幅短縮
- 複数サイトを横断する手間の解消
- 財務データの取得・加工作業の自動化

### プロダクト視点
- EDINET対象書類の安定した取得・解析
- 財務指標の正確な計算
- Jupyter Notebookからの使いやすいAPI提供

---

## 今後の検討事項

### まだ決めてないこと
- LLM分析の設計方針（Jupyter Notebookでの試行錯誤後に決定）
  - 要約生成の粒度とフォーマット
  - ベクトル検索の活用方法
  - プロンプト設計
- 株価データとの統合方法（別プロジェクトとの連携）

### 技術的に不安なこと
- XBRL解析の複雑さ（EDINET独自タクソノミー、インラインXBRL対応）
- EDINET APIのレート制限と安定性
- PDF解析の精度（特に複雑な表のマークダウン化）
- 日次バッチ処理の運用設計



---

## 調査レポート

以下の技術調査が完了しています:

| 調査項目 | レポート | 状態 |
|---------|---------|------|
| EDINET API仕様 | [edinet-api-specification.md](../research/edinet-api-specification.md) | ✅ 完了 |
| XBRL仕様 | [xbrl-specification.md](../research/xbrl-specification.md) | ✅ 完了 |

---

## 次のステップ

### ✅ 完了: 技術調査フェーズ

1. **EDINET API仕様調査** → [調査レポート](../research/edinet-api-specification.md)
   - 書類一覧API・書類取得APIの仕様確認
   - 認証方式（Subscription-Key）の確認
   - 利用制限（過去10年、クロスドメイン不可）の把握

2. **XBRL仕様調査** → [調査レポート](../research/xbrl-specification.md)
   - EDINETタクソノミの構造理解（jppfs、jpcrp等の名前空間）
   - 財務諸表項目（BS/PL/CF）のXBRL要素名マッピング
   - 既存ライブラリ評価（edinet-xbrl、Arelle、BeautifulSoup）

### 🔜 次: プロトタイプ開発フェーズ

調査結果を踏まえた実装計画:

3. **フェーズ1: EDINET API連携（PoC）**
   - APIキー取得・認証実装
   - 書類一覧取得（メタデータ→詳細の2段階取得）
   - 書類ダウンロード（ZIP/PDF/XBRL）
   - エラーハンドリング（レスポンス内statusで判定）

4. **フェーズ2: XBRL解析（PoC）**
   - BeautifulSoup + lxmlで軽量実装
   - 主要財務項目の抽出（売上高、営業利益、総資産等）
   - 複数要素名候補によるフォールバック対応
   - コンテキスト解析（期間、連結/単体の判別）

5. **フェーズ3: 統合・検証**
   - 10社程度でのテスト
   - データクレンジング（スケール変換、負数処理）
   - Jupyter Notebook用APIの整備
