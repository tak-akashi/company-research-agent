---
description: 受入条件のチェックと検証レポート生成
---

# 受入条件チェック（対話型）

**引数:** 機能名 (例: `/check-acceptance EDINET API連携`)

このコマンドはPRDの受入条件に対する実装・テストのカバレッジを確認し、
不足項目を特定するためのレポートを生成します。

---

## ステップ1: ステアリングディレクトリの特定/作成

1. `.steering/` 配下で引数の機能名にマッチするディレクトリを検索
2. 見つかった場合 → そのディレクトリを使用
3. 見つからない場合 → `.steering/[YYYYMMDD]-[機能名]/` を新規作成
4. レポート保存先: `[ステアリングディレクトリ]/acceptance-check.md`

## ステップ2: PRDから受入条件を抽出

1. `docs/product-requirements.md`を読み込む
2. 引数で指定された機能名に対応するセクションを特定
   - 見つからない場合は利用可能な機能一覧を表示
3. 受入条件（`- [ ]` または `- [x]` の項目）を抽出
4. 検証方法のテーブルも抽出
5. **ユーザーに確認**: 抽出した受入条件を表示し、対象が正しいか確認

## ステップ3: テストコードのカバレッジ確認

1. Task toolでExploreサブエージェントを起動し、テストコードを調査:
   - subagent_type: "Explore"
   - prompt: "[機能名]に関連するテストコードを探し、各受入条件のカバレッジを分析してください"
2. 各受入条件に対応するテストケースを特定
3. テストカバレッジを評価:
   - ✅ 完全: テストが存在し、受入条件を網羅
   - ⚠️ 部分的: テストは存在するが不完全
   - ❌ なし: テストが存在しない

## ステップ4: 実装状況の確認

1. `src/` 配下で関連する実装をGrepで検索
2. 各受入条件に対応する実装を特定
3. 実装状況を評価:
   - ✅ 完了: 機能が実装済み
   - ⚠️ 部分的: 一部のみ実装
   - ❌ 未実装: 実装なし

## ステップ5: チェックリスト出力 & レポート保存

以下の形式でレポートを出力:

```markdown
# 受入条件チェック結果

## 機能: [機能名]
## 日時: [YYYY-MM-DD HH:MM]
## 保存先: [ステアリングディレクトリパス]/acceptance-check.md

### カバレッジサマリ

| # | 受入条件 | 実装 | テスト | 状態 |
|---|---------|------|-------|------|
| 1 | [条件1] | ✅/❌ | ✅/❌ | 完了/未実装 |

### 検証詳細

#### 条件1: [条件内容]
- **実装**: [ファイルパス:行番号] or 未実装
- **テスト**: [テストファイル::テスト名] or なし
- **検証方法**: [PRDの検証方法]

### 不足項目

1. [不足項目と対応案]

### 次のアクション

- [ ] [推奨対応1]
- [ ] [推奨対応2]
```

2. レポートを `[ステアリングディレクトリ]/acceptance-check.md` に保存
3. 保存先パスをユーザーに通知

## ステップ6: 対応方針の確認

**ユーザーに確認**: 不足項目がある場合、以下を提案:
1. 実装の追加が必要な場合 → `/add-feature` での実装を提案
2. テストの追加のみ必要な場合 → テストコード作成を提案
3. 全て完了している場合 → PRD手動更新を推奨

---

## 注意事項

- PRDに該当する機能が見つからない場合は利用可能な機能一覧を表示
- 複数の機能にマッチする場合は候補を表示して選択を求める
- PRDの受入条件チェックボックスは自動更新しない（手動で更新）
- 検証方法が詳細に記載されている場合は、その内容も出力に含める
